<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›³é‘‘ãƒªã‚¹ãƒˆ | Guide to Humans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0d1117; color: #e6edf3; font-family: 'Helvetica Neue', Arial, sans-serif; }
        .emerald-glow { box-shadow: 0 0 15px rgba(16, 185, 129, 0.1); }
        .tag-badge { background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); }
    </style>
</head>
<body class="p-6 max-w-md mx-auto min-h-screen flex flex-col">
    <header class="mb-8 flex items-center justify-between">
        <button onclick="location.href='index.html'" class="text-emerald-400 font-bold hover:brightness-125 transition-all">
            â† æ‹ ç‚¹ã¸æˆ»ã‚‹
        </button>
        <h2 class="text-xl font-bold tracking-widest text-emerald-500">COLLECTION</h2>
    </header>

    <main id="collection-list" class="space-y-6 flex-1">
        </main>

    <footer class="mt-12 text-center text-gray-600 text-[10px] tracking-widest uppercase">
        &copy; Human Observation Project
    </footer>

    <script>
    // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    let collections = JSON.parse(localStorage.getItem('gth_collections') || '[]');
    const container = document.getElementById('collection-list');

    function renderList() {
        container.innerHTML = ""; 

        if (collections.length > 0) {
            collections.forEach((item, index) => {
                // å±æ€§ã‚¿ã‚°ãŒã€Œ / ã€ã§åŒºåˆ‡ã‚‰ã‚Œã¦ã„ã‚‹å ´åˆã€é…åˆ—ã«åˆ†è§£ã—ã¦ãƒãƒƒã‚¸åŒ–ã—ã¾ã™
                const tags = item.tag.split(' / ');
                const tagHtml = tags.map(t => `<span class="tag-badge text-[10px] text-emerald-400 px-2 py-0.5 rounded-full mr-1 mb-1 inline-block">${t}</span>`).join('');

                const card = document.createElement('div');
                card.className = "bg-gray-800/50 p-5 rounded-2xl border border-emerald-500/20 emerald-glow transition-all active:scale-[0.98]";
                card.innerHTML = `
                    <div class="mb-3">
                        <div class="flex flex-wrap mb-2">
                            ${tagHtml}
                        </div>
                        <div class="text-xl font-bold text-white flex items-center">
                            <span class="w-1.5 h-1.5 bg-emerald-500 rounded-full mr-2 animate-pulse"></span>
                            ${item.nickname}
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center mt-4 pt-4 border-t border-gray-700/50">
                        <div class="text-[9px] text-gray-500 font-mono">
                            ID: ${String(index + 1).padStart(3, '0')}<br>
                            DATE: ${new Date(item.date).toLocaleDateString()}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="reAnalyze(${index})" class="text-[10px] font-bold bg-emerald-600 hover:bg-emerald-500 text-white px-4 py-2 rounded-lg transition-all">
                                å†è§£æ
                            </button>
                            <button onclick="deleteEntry(${index})" class="text-[10px] font-bold bg-gray-900 border border-red-900/30 text-red-400/70 hover:bg-red-900/20 px-4 py-2 rounded-lg transition-all">
                                ç ´æ£„
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(card);
            });
        } else {
            container.innerHTML = `
                <div class="text-center py-20">
                    <div class="text-4xl mb-4 opacity-20">ğŸ”¬</div>
                    <p class="text-gray-500 text-sm italic">
                        ã€Œã¾ã è¦³æ¸¬ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ãªã€‚<br>å¤–ã®ä¸–ç•Œã¸å‡ºã¦ã€ãƒã‚°ã‚’æ¢ã—ã¦ãã‚‹ã®ã§ã™ãï¼ã€
                    </p>
                </div>
            `;
        }
    }
// --- renderListé–¢æ•°ã®æœ€å¾Œã®æ–¹ã«è¿½åŠ  ---
if (collections.length >= 3) {
    const reportDiv = document.createElement('div');
    reportDiv.className = "mt-12 p-6 bg-emerald-900/20 rounded-3xl border-2 border-dashed border-emerald-500/30 text-center";
    
    // 1. æœ€ã‚‚å¤šã„å±æ€§ï¼ˆã‚¿ã‚°ï¼‰ã‚’ç‰¹å®šã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
    const allTags = collections.flatMap(item => item.tag.split(' / '));
    const tagCounts = allTags.reduce((acc, t) => (acc[t] = (acc[t] || 0) + 1, acc), {});
    const topTag = Object.keys(tagCounts).reduce((a, b) => tagCounts[a] > tagCounts[b] ? a : b);

    // 2. ãƒ¯ã‚¿ã‚¯ã‚·ã‹ã‚‰ã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
    let feedback = "";
    if (topTag === "å¤©ç„¶") {
        feedback = "å›ã®å‘¨ã‚Šã¯å¥‡è·¡ã®ãƒã‚°ï¼ˆå¤©ç„¶ï¼‰ã§æº¢ã‚Œã¦ã„ã¾ã™ãªï¼é€€å±ˆã¨ã¯ç„¡ç¸ã®äººç”Ÿã§ã™ãŒã€ãƒ„ãƒƒã‚³ãƒŸå½¹ã¨ã—ã¦éè² è·ã«ãªã‚‰ãªã„ã‚ˆã†æ³¨æ„ã—ãŸã¾ãˆã€‚";
    } else if (topTag === "éŸ³é‡ãƒã‚°" || topTag === "è¦ç´„ç¦æ­¢") {
        feedback = "è³‘ã‚„ã‹ï¼ˆé¨’ãŒã—ã„ï¼‰å€‹ä½“ãŒå¤šã„ã‚ˆã†ã§ã™ãªã€‚å›ã®è€³ã®å¥åº·ãŒå¿ƒé…ã§ã™ãã€‚ãŸã¾ã«ã¯é™å¯‚ã¨ã„ã†åã®ãƒ‘ãƒƒãƒã‚’å½“ã¦ã¦ä¼‘ã¿ãŸã¾ãˆã€‚";
    } else {
        feedback = `ç¾åœ¨ã€å›ã®å‘¨è¾ºã§ã¯ [${topTag}] å±æ€§ã®å€‹ä½“ãŒæ´»ç™ºã«æ´»å‹•ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚ã“ã®èª¿å­ã§ãƒ‡ãƒ¼ã‚¿ã‚’ç©ã¿ä¸Šã’ã€äººé–“ãƒãƒ‹ã‚¢ã‚’ç›®æŒ‡ã—ãŸã¾ãˆï¼`;
    }

    reportDiv.innerHTML = `
        <div class="text-xs text-emerald-400 font-bold mb-2 tracking-widest">CURRENT BIOME REPORT</div>
        <h3 class="text-lg font-bold mb-3">ã€ å‘¨è¾ºç”Ÿæ…‹ç³»ãƒ¬ãƒãƒ¼ãƒˆ ã€‘</h3>
        <p class="text-sm text-gray-300 leading-relaxed italic">ã€Œ${feedback}ã€</p>
        <div class="mt-4 text-[10px] text-emerald-500/50">ç·è¦³æ¸¬æ•°ï¼š${collections.length}ä½“ / ä¸»è¦è¦³æ¸¬å¯¾è±¡ï¼š${topTag}</div>
    `;
    container.appendChild(reportDiv);
}
    // å‰Šé™¤ã‚’å®Ÿè¡Œã™ã‚‹é–¢æ•°
    function deleteEntry(index) {
        if (confirm("ã“ã®å€‹ä½“ã®ç ”ç©¶ãƒ‡ãƒ¼ã‚¿ã‚’å®Œå…¨ã«ç ´æ£„ã—ã¾ã™ã‹ï¼Ÿ")) {
            collections.splice(index, 1);
            localStorage.setItem('gth_collections', JSON.stringify(collections));
            renderList();
        }
    }

    // å†è§£æï¼ˆçµæœç”»é¢ã¸æˆ»ã‚‹ï¼‰
    function reAnalyze(index) {
    const target = collections[index];
    
    // â˜… ã“ã“ã«å†è§£æã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ ï¼
    target.reanalyzeCount = (target.reanalyzeCount || 0) + 1;
    localStorage.setItem('gth_collections', JSON.stringify(collections)); // ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’ä¿å­˜ã—ç›´ã™

    localStorage.setItem('gth_nickname', target.nickname);
    localStorage.setItem('gth_tag', target.tag.replace(/ \/ /g, ','));
    location.href = 'result.html';
}

    // æœ€åˆã«ãƒªã‚¹ãƒˆã‚’è¡¨ç¤º
    renderList();
    </script>
</body>
</html>