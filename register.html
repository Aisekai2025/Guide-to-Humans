<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>個体登録 | Guide to Humans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0d1117; color: #e6edf3; font-family: sans-serif; }
        .emerald-border { border-color: rgba(16, 185, 129, 0.3); }
        /* カスタムスクロールバー（ラボ風） */
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #10b981; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen pb-20"> <header class="sticky top-0 z-10 bg-[#0d1117]/80 backdrop-blur-md p-4 border-b border-emerald-500/20 flex items-center gap-4">
        <button onclick="location.href='index.html'" class="text-emerald-400 font-bold">← 戻る</button>
        <h2 class="text-lg font-bold">新種個体の登録</h2>
    </header>

    <main class="p-6 space-y-8 max-w-md mx-auto">
        
        <section>
            <label class="block text-[10px] text-emerald-500 uppercase tracking-widest mb-2 font-bold">Individual Nickname</label>
            <input type="text" id="nickname" placeholder="例：朝の機嫌が悪い大臣"
                class="w-full bg-gray-900 border emerald-border rounded-xl px-4 py-3 focus:outline-none focus:border-emerald-500 text-white placeholder-gray-600 shadow-inner">
        </section>

        <section class="space-y-4">
            <label class="block text-[10px] text-emerald-500 uppercase tracking-widest mb-2 font-bold">Attribute Scan</label>
            
            <div class="bg-gray-900/50 p-3 rounded-xl border border-emerald-500/10">
                <p class="text-[9px] text-gray-500 mb-2 uppercase italic">Selected (Max 3)</p>
                <div id="selected-tags-container" class="flex flex-wrap gap-2 min-h-[28px]">
                    </div>
            </div>

            <div class="grid grid-cols-3 gap-2" id="category-buttons">
                </div>

            <div id="tag-display-area" class="grid grid-cols-2 gap-2 transition-all duration-300 min-h-[120px] bg-gray-900/30 p-2 rounded-xl border border-dashed border-gray-800">
                <p class="col-span-2 text-center text-gray-500 py-10 text-xs">カテゴリーを選択してスキャンを開始したまえ</p>
            </div>
        </section>

        <section>
            <label class="block text-[10px] text-emerald-500 uppercase tracking-widest mb-2 font-bold">Observation Log</label>
            <textarea id="observation-note" placeholder="例：意外とおだてに弱い。午前中は機嫌が悪いようだ..." 
                class="w-full bg-gray-900 border emerald-border rounded-xl p-3 text-sm text-white focus:border-emerald-500 outline-none h-24 resize-none shadow-inner"></textarea>
        </section>

        <section>
            <label class="block text-[10px] text-emerald-500 uppercase tracking-widest mb-2 font-bold">Behavior Episode</label>
            <textarea id="episode" placeholder="いつ、どんなバグ（行動）が発生したか記述せよ..."
                class="w-full bg-gray-900 border emerald-border rounded-xl p-3 text-sm text-white focus:border-emerald-500 outline-none h-24 resize-none shadow-inner"></textarea>
        </section>

        <button onclick="analyzeHuman()" class="w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-2xl shadow-[0_0_20px_rgba(16,185,129,0.4)] transition-all active:scale-95 text-lg">
            解析（攻略アドバイス）を開始
        </button>

    </main>

    <script>
        const tagDatabase = {
            "通信OS": ["要約禁止", "音量バグ", "正論パンチ", "主語喪失", "既読スルー仕様", "話泥棒", "オウム返し", "遠回しプロトコル"],
            "動作OS": ["空腹暴走", "充電切れ", "夜行性", "せっかち", "のんびり屋", "ルーチン固執", "探し物バグ", "方向音痴OS"],
            "感情OS": ["褒め殺し弱点", "ツンデレ", "豆腐メンタル", "鋼鉄の意志", "涙腺崩壊", "寂しがり屋", "冷笑フィルター", "嫉妬センサー"],
            "社会OS": ["空気読みすぎ", "マイペース", "社交的", "忖度エンジン", "忖度ゼロ", "秘密保持エラー", "お節介プログラム"],
            "特殊": ["天然", "雑学王", "コレクター", "デジタル中毒", "アナログ派", "レアキャラ", "ラスボス感"]
        };

        let selectedTags = [];

        window.onload = () => { renderCategories(); };

        function renderCategories() {
            const container = document.getElementById('category-buttons');
            container.innerHTML = '';
            Object.keys(tagDatabase).forEach(cat => {
                const btn = document.createElement('button');
                btn.className = "py-2 px-1 bg-gray-800 border border-emerald-500/20 rounded-lg text-[10px] font-bold text-emerald-400 hover:bg-emerald-900/20";
                btn.textContent = cat;
                btn.onclick = () => showTags(cat);
                container.appendChild(btn);
            });
        }

        function showTags(category) {
            const area = document.getElementById('tag-display-area');
            area.style.opacity = '0';
            setTimeout(() => {
                area.innerHTML = '';
                tagDatabase[category].forEach(tag => {
                    const btn = document.createElement('button');
                    const isSelected = selectedTags.includes(tag);
                    btn.className = `py-3 px-2 rounded-xl border text-[10px] transition-all ${isSelected ? 'bg-emerald-600 border-emerald-400 text-white' : 'bg-gray-800 border-gray-700 text-gray-400'}`;
                    btn.textContent = `[${tag}]`;
                    btn.onclick = () => toggleTag(tag, category);
                    area.appendChild(btn);
                });
                area.style.opacity = '1';
            }, 150);
        }

        function toggleTag(tag, category) {
            const index = selectedTags.indexOf(tag);
            if (index > -1) { selectedTags.splice(index, 1); }
            else if (selectedTags.length < 3) { selectedTags.push(tag); }
            else { alert("属性は3つまでですぞ！"); }
            updateSelectedDisplay();
            showTags(category);
        }

        function updateSelectedDisplay() {
            const container = document.getElementById('selected-tags-container');
            container.innerHTML = '';
            selectedTags.forEach(tag => {
                const span = document.createElement('span');
                span.className = "bg-emerald-500 text-gray-900 text-[9px] font-bold px-2 py-1 rounded-full animate-bounce";
                span.textContent = tag;
                container.appendChild(span);
            });
        }

        function analyzeHuman() {
            const nickname = document.getElementById('nickname').value;
            const note = document.getElementById('observation-note').value;
            const episode = document.getElementById('episode').value;
            
            if(!nickname) return alert("ニックネームをスキャンしたまえ！");
            if(selectedTags.length === 0) return alert("属性を1つ以上選ぶのだ！");

            // 図鑑用データの構築
            const newEntry = {
                nickname: nickname,
                tag: selectedTags.join(' / '),
                note: note,
                episode: episode,
                timestamp: new Date().toLocaleString()
            };

            // localStorageへの保存（配列として保存）
            const collections = JSON.parse(localStorage.getItem('gth_collections') || '[]');
            collections.unshift(newEntry);
            localStorage.setItem('gth_collections', JSON.stringify(collections));

            // 結果画面でも使いやすいよう単一キーでも一時保存
            localStorage.setItem('gth_nickname', nickname);
            localStorage.setItem('gth_tag', selectedTags.join(','));

            location.href = 'result.html'; 
        }
    </script>
</body>
</html>