<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>個体登録 | Guide to Humans</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0d1117; color: #e6edf3; }
        .emerald-border { border-color: #10b981; }
        .tag-selected { background-color: #10b981; color: white; border-color: #10b981; }
    </style>
</head>
<body class="p-6 max-w-md mx-auto">
    <header class="mb-8 flex items-center gap-4">
        <button onclick="location.href='index.html'" class="text-emerald-400 font-bold">← 戻る</button>
        <h2 class="text-xl font-bold">新種個体の登録</h2>
    </header>

    <main class="space-y-6">
        <!-- ニックネーム -->
        <section>
            <label class="block text-sm font-medium text-emerald-400 mb-2">個体のニックネーム</label>
            <input type="text" id="nickname" placeholder="例：朝の機嫌が悪い大臣"
                class="w-full bg-gray-900 border emerald-border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 placeholder-gray-600">
        </section>

        <!-- 属性タグ -->
        <section>
            <label class="block text-sm font-medium text-emerald-400 mb-2">検知された属性（複数選択可）</label>
            <div id="tag-container" class="flex flex-wrap gap-2">
                <!-- JavaScriptでタグを生成 -->
            </div>
        </section>

        <!-- エピソード -->
        <section>
            <label class="block text-sm font-medium text-emerald-400 mb-2">具体的なバグ（行動）エピソード</label>
            <textarea id="episode" rows="4" placeholder="いつ、どんなバグが発生したか記述せよ..."
                class="w-full bg-gray-900 border emerald-border rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-emerald-500 placeholder-gray-600"></textarea>
        </section>

        <!-- 解析ボタン -->
        <button onclick="analyzeHuman()" class="w-full py-4 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded-xl shadow-lg transition-all active:scale-95 text-lg">
            解析（攻略アドバイス）を開始する
        </button>
    </main>
<div class="w-full max-w-md mx-auto space-y-6">
    <div class="bg-gray-900/50 p-3 rounded-xl border border-emerald-500/20">
        <p class="text-[10px] text-emerald-400 mb-2 uppercase tracking-widest">Selected Tags (Max 3)</p>
        <div id="selected-tags-container" class="flex flex-wrap gap-2 min-h-[32px]">
            </div>
    </div>

    <div class="grid grid-cols-2 gap-2" id="category-buttons">
        </div>

    <hr class="border-emerald-500/10">

    <div id="tag-display-area" class="grid grid-cols-2 gap-2 transition-all duration-300 opacity-0 transform translate-y-4">
        <p class="col-span-2 text-center text-gray-500 py-10 text-sm">カテゴリーを選択してスキャンを開始したまえ</p>
    </div>
</div>

   <script>
    // 1. 50種類の属性データベース（OSカテゴリー分け版）
    const tagDatabase = {
        "通信OS": ["要約禁止", "音量バグ", "正論パンチ", "主語喪失", "既読スルー仕様", "話泥棒", "オウム返し", "独り言モード", "遠回しプロトコル", "沈黙の壁"],
        "動作OS": ["空腹暴走", "充電切れ", "低気圧に弱い", "夜行性", "せっかち", "のんびり屋", "ルーチン固執", "探し物バグ", "方向音痴OS", "ギリギリ駆動"],
        "感情OS": ["褒め殺し弱点", "ツンデレ", "豆腐メンタル", "鋼鉄の意志", "涙腺崩壊", "ポーカーフェイス", "寂しがり屋", "熱血モード", "冷笑フィルター", "嫉妬センサー"],
        "社会OS": ["空気読みすぎ", "マイペース", "社交的", "内向的", "リーダー志向", "フォロワー属性", "忖度エンジン", "忖度ゼロ", "秘密保持エラー", "お節介プログラム"],
        "特殊仕様": ["天然", "雑学王", "コレクター", "ロマンチスト", "リアリスト", "健康オタク", "デジタル中毒", "アナログ派", "レアキャラ", "ラスボス感"]
    };

    let selectedTags = []; // 選択されたタグを格納する配列ですぞ

    // 2. 画面起動時の初期設定
    window.onload = () => {
        renderCategories();
    };

    // 3. カテゴリーボタンの生成
    function renderCategories() {
        const container = document.getElementById('category-buttons'); // HTML側にこのIDが必要ですぞ
        container.innerHTML = '';
        Object.keys(tagDatabase).forEach(cat => {
            const btn = document.createElement('button');
            btn.type = "button"; // フォーム送信を防ぐため
            btn.className = "py-2 px-3 bg-gray-800 border border-emerald-500/30 rounded-lg text-xs font-bold hover:bg-emerald-900/20 transition-all";
            btn.textContent = cat;
            btn.onclick = () => showTags(cat);
            container.appendChild(btn);
        });
    }

    // 4. タグを「シュパッと」表示する関数
    function showTags(category) {
        const area = document.getElementById('tag-display-area'); // HTML側にこのIDが必要ですぞ
        
        area.classList.remove('opacity-100', 'translate-y-0');
        area.classList.add('opacity-0', 'translate-y-4');

        setTimeout(() => {
            area.innerHTML = '';
            tagDatabase[category].forEach(tag => {
                const btn = document.createElement('button');
                btn.type = "button";
                const isSelected = selectedTags.includes(tag);
                btn.className = `py-3 px-2 rounded-xl border text-[11px] transition-all active:scale-95 ${isSelected ? 'bg-emerald-600 border-emerald-400 text-white' : 'bg-gray-900 border-emerald-500/20 text-gray-400'}`;
                btn.textContent = `[${tag}]`;
                btn.onclick = () => toggleTag(tag, category);
                area.appendChild(btn);
            });

            area.classList.remove('opacity-0', 'translate-y-4');
            area.classList.add('opacity-100', 'translate-y-0');
        }, 150);
    }

    // 5. タグの選択・解除
    function toggleTag(tag, category) {
        const index = selectedTags.indexOf(tag);
        if (index > -1) {
            selectedTags.splice(index, 1);
        } else if (selectedTags.length < 3) {
            selectedTags.push(tag);
        } else {
            alert("属性は3つまでですぞ！");
        }
        updateSelectedDisplay();
        showTags(category); // 再描画して色を更新
    }

    // 6. 選択済み表示の更新
    function updateSelectedDisplay() {
        const container = document.getElementById('selected-tags-container');
        if(!container) return;
        container.innerHTML = '';
        selectedTags.forEach(tag => {
            const span = document.createElement('span');
            span.className = "bg-emerald-500 text-gray-900 text-[10px] font-bold px-2 py-1 rounded-full animate-bounce";
            span.textContent = tag;
            container.appendChild(span);
        });
    }

    // 7. 【重要】解析実行ボタンの関数（以前のものをパワーアップ！）
    function analyzeHuman() {
        const nickname = document.getElementById('nickname').value;
        
        if(!nickname) return alert("ニックネームを入力するのだ！");
        if(selectedTags.length === 0) return alert("属性を1つ以上選ぶのだ！");

        // データの保存
        localStorage.setItem('gth_nickname', nickname);
        // 複数のタグをカンマ区切りで保存（result.htmlで受け取れるように！）
        localStorage.setItem('gth_tag', selectedTags.join(',')); 

        // 結果画面へ遷移
        location.href = 'result.html'; 
    }
</script>
</body>
</html>
